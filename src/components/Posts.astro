---
import { type CollectionEntry } from 'astro:content'
import dayjs from 'dayjs'
import customParseFormat from 'dayjs/plugin/customParseFormat'
import ReadingTime from './ReadingTime.astro'

type PostWithReadingTime = (CollectionEntry<'blogPosts'> | CollectionEntry<'journal'>) & {
  readingTime?: { minutes: number; display: string }
}

interface Props {
  entrySlugStart: '/blog' | '/journal'
  posts: PostWithReadingTime[]
}

dayjs.extend(customParseFormat)

const { entrySlugStart, posts } = Astro.props
const sortedPosts = posts.sort(
  (a, b) =>
    Date.parse(new Date(b.data.date).toString()) -
    Date.parse(new Date(a.data.date).toString())
)
---

{
  sortedPosts.map((post) => (
    <article class="mb-6">
      <h3
        class="mb-1 break-words text-2xl font-semibold tracking-wide dark:text-white"
        transition:name={`post-title-${post.data.slug}`}
      >
        <a
          class="tracking-tighter hover:text-sky-500"
          href={`${entrySlugStart}/${post.data.slug}`}
        >
          {post.data.title}
        </a>
      </h3>
      <div class="flex flex-col gap-1 text-sm tracking-wide text-slate-700 dark:text-slate-500">
        <time
          datetime={dayjs(post.data.date).format('YYYY-MM-DD')}
          transition:name={`post-date-${post.data.slug}`}
        >
          Published on {dayjs(post.data.date).format('MMMM DD, YYYY')}
        </time>
        {post.readingTime && (
          <ReadingTime minutes={post.readingTime.minutes} display={post.readingTime.display} />
        )}
      </div>
    </article>
  ))
}
